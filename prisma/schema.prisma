// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                     Int        @id @default(autoincrement())
  username               String     @unique
  passwordHash           String
  role                   String     @default("ADMIN") // "ADMIN" | "SUPERADMIN"
  isActive               Boolean    @default(true)
  isSystem               Boolean    @default(false)

  adminTag               String     @default("NONE")
  avatarUrl              String?

  twoFactorEnabled       Boolean    @default(false)
  twoFactorSecret        String?
  twoFactorConfirmed     Boolean    @default(false)

  // üî• –ù–û–í–û–ï –ü–û–õ–ï ‚Äî —Ñ–æ—Ä—É–º–Ω—ã–π –Ω–∏–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  forumNick              String?    // –Ω–∏–∫ –Ω–∞ —Ñ–æ—Ä—É–º–µ Majestic, null –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω

  lastComplaintCode      String?
  lastComplaintUpdatedAt DateTime?

  punishments            Punishment[]
  adminLogs              AdminLog[]
}

model Punishment {
  id            Int      @id @default(autoincrement())
  adminId       Int
  admin         User     @relation(fields: [adminId], references: [id], onDelete: Cascade)
  type          String   // 'ajail' | 'mute' | 'warn' | 'ban' | 'hardban' | 'gunban'
  staticId      Int
  duration      Int      // –≤ –º–∏–Ω—É—Ç–∞—Ö (0 –¥–ª—è warn)
  durationUnit  String   // 'MINUTES' | 'NONE'
  complaintCode String
  issued        Boolean  @default(false)
  command       String
  createdAt     DateTime @default(now())

  @@index([adminId, createdAt])
}

model Setting {
  id    Int    @id @default(autoincrement())
  key   String @unique
  value String
}

model AdminLog {
  id        Int      @id @default(autoincrement())
  adminId   Int
  admin     User     @relation(fields: [adminId], references: [id], onDelete: Cascade)
  action    String   // 'CREATE_ADMIN', 'DELETE_ADMIN', ...
  meta      String?
  createdAt DateTime @default(now())

  @@index([createdAt])
}